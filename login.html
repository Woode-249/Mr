<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MERAC — Login / Sign Up</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest/dist/lucide.min.js"></script>

<style>
  :root{
    --bg1:#060616; --bg2:#0b1330;
    --accent-from:#3EC8FF; --accent-to:#7A4BFF;
    --glass-1: rgba(255,255,255,0.03);
    --glass-2: rgba(255,255,255,0.015);
    --input-border: rgba(255,255,255,0.06);
    --muted: rgba(255,255,255,0.62);
    --shadow: 0 18px 60px rgba(2,6,23,0.65);
    --card-w: 520px;
    --otp-size: 48px;
  }
  @media (max-width:520px){
    :root{ --card-w: 94vw; --otp-size: 44px; }
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:'Poppins',system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    background:
      radial-gradient(1000px 500px at 14% 62%, rgba(62,200,255,0.06), transparent 8%),
      radial-gradient(800px 500px at 88% 52%, rgba(122,75,255,0.08), transparent 10%),
      linear-gradient(180deg,var(--bg2),var(--bg1));
    color:#fff;
    display:flex; align-items:center; justify-content:center;
    padding:36px;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }

  /* Top controls */
  .top-controls{
    position:fixed; top:22px; left:22px; right:22px;
    display:flex; justify-content:space-between; align-items:center;
    pointer-events:none; z-index:60;
  }
  .top-controls button{
    pointer-events:auto; cursor:pointer;
    border-radius:12px; padding:10px 14px; font-size:14px;
    backdrop-filter: blur(6px);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.02);
    color: var(--muted);
  }
  .lang-btn{ display:inline-flex; gap:8px; align-items:center; color:#fff; border:1px solid rgba(255,255,255,0.03); background: rgba(255,255,255,0.03); }

  /* Card */
  .card{
    width:var(--card-w); max-width:94vw;
    border-radius:20px; padding:28px;
    background: linear-gradient(180deg,var(--glass-1),var(--glass-2));
    border:1px solid rgba(58,86,255,0.04);
    box-shadow: var(--shadow); backdrop-filter: blur(10px) saturate(120%);
    position:relative; overflow:hidden;
  }
  .logo{ display:flex; gap:14px; align-items:center; justify-content:center; margin-bottom:18px; }
  .logo img{ width:72px; height:72px; object-fit:contain; }
  .logo h1{ margin:0; font-size:36px; font-weight:800; letter-spacing:1px; }

  /* Tabs */
  .tabs{ display:flex; gap:8px; justify-content:center; margin-bottom:18px; }
  .tab-btn{
    flex:1; text-align:center; padding:10px 12px; border-radius:12px; cursor:pointer;
    font-weight:600; background:transparent; border:1px solid transparent;
    color: rgba(255,255,255,0.86); transition: all .18s ease; user-select:none;
  }
  .tab-btn.active{
    background: linear-gradient(90deg,var(--accent-from),var(--accent-to));
    color:#fff; box-shadow: 0 8px 28px rgba(122,75,255,0.12); transform: translateY(-2px);
  }

  /* Forms */
  .forms{ position:relative; height:auto; }
  .form-panel{ transition: transform .28s cubic-bezier(.2,.9,.3,1), opacity .2s ease; }
  .form-panel.hidden{ opacity:0; pointer-events:none; transform: translateY(10px); height:0; overflow:hidden; }

  /* Fields */
  .field{ position:relative; margin-bottom:14px; }
  .field .icon{ position:absolute; left:12px; top:50%; transform:translateY(-50%); opacity:0.95; pointer-events:none; }
  body[dir="rtl"] .field .icon{ left:auto; right:12px; }

  .input{
    width:100%; height:52px; padding:12px 14px 12px 44px;
    border-radius:12px; border:1px solid var(--input-border);
    background: rgba(255,255,255,0.01); color:#fff; outline:none; font-size:15px;
    transition: box-shadow .14s ease, border .14s ease;
  }
  body[dir="rtl"] .input{ padding:12px 44px 12px 14px; }
  .input::placeholder{ color: rgba(255,255,255,0.36); }
  .input:focus{ border:1px solid rgba(255,255,255,0.12); box-shadow: 0 8px 22px rgba(2,6,23,0.5); background: rgba(255,255,255,0.015); }

  .show-pass{
    position:absolute; right:10px; top:50%; transform: translateY(-50%);
    background:transparent; border:none; cursor:pointer; font-size:16px; color:rgba(255,255,255,0.7);
  }
  body[dir="rtl"] .show-pass{ right:auto; left:10px; }

  /* Phone field with country code */
  .phone-wrap{ position:relative; }
  .code-pill{
    position:absolute; top:6px; left:6px; height:40px; display:inline-flex; align-items:center; gap:6px;
    padding:0 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.06);
    background: rgba(255,255,255,0.03); color:#fff; cursor:pointer; z-index:2;
  }
  .code-pill i{ opacity:.9 }
  .phone-input{ padding-left:92px !important; } /*  code-pill width + spacing  */
  body[dir="rtl"] .code-pill{ left:auto; right:6px; }
  body[dir="rtl"] .phone-input{ padding-right:92px !important; padding-left:14px !important; }

  .row{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
  .remember{ display:flex; gap:8px; align-items:center; color:var(--muted); font-size:14px; }
  .forgot-link{ color:rgba(255,255,255,0.86); cursor:pointer; text-decoration:none; font-size:14px; }

  /* Buttons */
  .btn{ width:100%; height:54px; border-radius:14px; border:none; font-weight:700; font-size:16px; cursor:pointer; }
  .btn.primary{ background: linear-gradient(90deg,var(--accent-from),var(--accent-to)); color:#fff; box-shadow: 0 12px 36px rgba(122,75,255,0.14); }
  .btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:rgba(255,255,255,0.9); }

  .muted-center{ text-align:center; color:var(--muted); font-size:13px; margin-top:10px; }

  /* pw meter */
  .pw-meter{ height:8px; background: rgba(255,255,255,0.05); border-radius:8px; overflow:hidden; margin-top:8px; }
  .pw-meter > i{ display:block; height:100%; width:0%; transition: width .2s ease; background: linear-gradient(90deg,#ff6b6b,#ffd86b); }

  /* Modals */
  .backdrop{
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
    background: rgba(4,8,18,0.55); z-index:120; visibility:hidden; opacity:0; transition:opacity .14s ease, visibility .14s;
  }
  .backdrop.show{ visibility:visible; opacity:1; }
  .modal{
    width:720px; max-width:94vw; max-height:86vh; overflow:auto;
    border-radius:16px; padding:22px;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015));
    border:1px solid rgba(255,255,255,0.04);
    backdrop-filter: blur(12px) saturate(120%); box-shadow: 0 24px 80px rgba(3,6,20,0.6);
    color: rgba(255,255,255,0.98); position:relative;
  }
  .modal .close-x{ position:absolute; top:12px; right:14px; padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background: rgba(255,255,255,0.02); cursor:pointer; color:#fff; }
  .note{ font-size:13px; color: rgba(255,255,255,0.75); }

  /* Country picker modal */
  .picker-head{ display:flex; align-items:center; gap:10px; margin-bottom:12px; }
  .search{
    flex:1; height:44px; border-radius:12px; border:1px solid var(--input-border);
    background: rgba(255,255,255,0.02); color:#fff; outline:none; padding:10px 12px 10px 40px;
  }
  .search-wrap{ position:relative; flex:1; }
  .search-wrap i{ position:absolute; left:10px; top:50%; transform:translateY(-50%); opacity:.9 }
  body[dir="rtl"] .search-wrap i{ left:auto; right:10px; }
  body[dir="rtl"] .search{ padding:10px 40px 10px 12px; }

  .country-list{ margin-top:8px; border-top:1px solid rgba(255,255,255,0.05); }
  .country-item{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:10px 4px; border-bottom:1px solid rgba(255,255,255,0.04); cursor:pointer;
  }
  .country-item:hover{ background: rgba(255,255,255,0.02); }
  .country-name{ font-size:14px; }
  .country-code{ opacity:.9; font-weight:700; }

  /* Forgot / OTP */
  .method-toggle{ display:flex; gap:8px; margin:8px 0 12px; }
  .pill{
    flex:1; text-align:center; padding:10px 12px; border-radius:12px;
    border:1px solid rgba(255,255,255,0.06); background: rgba(255,255,255,0.02);
    color:#fff; cursor:pointer; user-select:none;
  }
  .pill.active{ background: linear-gradient(90deg,var(--accent-from),var(--accent-to)); border-color: transparent; }

  .otp-wrap{ display:grid; grid-template-columns: repeat(6, var(--otp-size)); gap:10px; justify-content:center; margin:12px 0; }
  .otp{ width:var(--otp-size); height:var(--otp-size); border-radius:12px; border:1px solid var(--input-border);
        background: rgba(255,255,255,0.02); color:#fff; font-size:22px; text-align:center; outline:none; }
  .resend-row{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:8px; }
  .small-btn{ padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:#fff; cursor:pointer; }
  .small-btn[disabled]{ opacity:.5; cursor:not-allowed; }

  @media (max-width:520px){
    .logo h1{ font-size:28px; }
    .card{ padding:18px; border-radius:14px; }
    .tab-btn{ padding:8px 10px; }
  }
</style>
</head>
<body dir="ltr">

  <!-- Top controls -->
  <div class="top-controls" aria-hidden="false">
    <button id="openTerms">Terms &amp; Conditions</button>
    <button class="lang-btn" id="langToggle"><i data-lucide="globe"></i> عربي</button>
  </div>

  <!-- Card -->
  <main class="card" role="main" aria-labelledby="meracTitle">
    <div class="logo">
      <img src="MERAC.F/static/img/logoo.png" alt="MERAC logo">
      <h1 id="meracTitle">MERAC</h1>
    </div>

    <!-- Tabs -->
    <div class="tabs" role="tablist" aria-label="Auth tabs">
      <div class="tab-btn active" id="tabLogin" role="tab" tabindex="0" aria-selected="true">Login</div>
      <div class="tab-btn" id="tabSignup" role="tab" tabindex="0" aria-selected="false">Sign Up</div>
    </div>

    <div class="forms">
      <!-- LOGIN PANEL -->
      <section class="form-panel" id="panelLogin" aria-labelledby="tabLogin">
        <form id="loginForm" onsubmit="return false;" autocomplete="on" novalidate>
          <div class="field">
            <span class="icon" aria-hidden="true"><i data-lucide="mail"></i></span>
            <input class="input" id="loginEmail" type="email" placeholder="Email" required autocomplete="username">
          </div>

          <div class="field">
            <span class="icon" aria-hidden="true"><i data-lucide="lock"></i></span>
            <input class="input" id="loginPassword" type="password" placeholder="Password" required autocomplete="current-password" minlength="6">
            <button type="button" class="show-pass" id="loginTogglePass" aria-label="Show password"><i data-lucide="eye"></i></button>
            <div class="pw-meter" aria-hidden="true"><i id="loginPwBar"></i></div>
          </div>

          <div class="row">
            <label class="remember"><input type="checkbox" id="rememberLogin"> <span id="rememberText">Remember me</span></label>
            <a class="forgot-link" id="openForgot">Forgot password?</a>
          </div>

          <button class="btn primary" id="doLogin">Log in</button>

          <div class="muted-center" style="margin-top:12px;">
            By signing in you agree to MERAC's
            <a id="footerTermsInline" style="color:rgba(255,255,255,0.9); text-decoration:underline; cursor:pointer">terms & conditions</a>.
          </div>
        </form>
      </section>

      <!-- SIGNUP PANEL -->
      <section class="form-panel hidden" id="panelSignup" aria-labelledby="tabSignup">
        <form id="signupForm" onsubmit="return false;" novalidate>
          <div class="field">
            <span class="icon" aria-hidden="true"><i data-lucide="user"></i></span>
            <input class="input" id="regName" type="text" placeholder="Full name" required>
          </div>

          <div class="field">
            <span class="icon" aria-hidden="true"><i data-lucide="mail"></i></span>
            <input class="input" id="regEmail" type="email" placeholder="Email" required>
          </div>

          <!-- Phone (required) with country code picker -->
          <div class="field phone-wrap">
            <button type="button" class="code-pill" id="openCountry">
              <i data-lucide="globe"></i><span id="selectedCode">+249</span><i data-lucide="chevrons-up-down"></i>
            </button>
            <span class="icon" aria-hidden="true" style="left:auto; right:12px;"><i data-lucide="phone"></i></span>
            <input class="input phone-input" id="regPhone" type="tel" placeholder="Phone number" required inputmode="tel" autocomplete="tel">
          </div>

          <div class="field">
            <span class="icon" aria-hidden="true"><i data-lucide="lock"></i></span>
            <input class="input" id="regPassword" type="password" placeholder="Password" required minlength="6">
            <button type="button" class="show-pass" id="regTogglePass" aria-label="Show password"><i data-lucide="eye"></i></button>
            <div class="pw-meter" aria-hidden="true"><i id="regPwBar"></i></div>
          </div>

          <div class="field">
            <span class="icon" aria-hidden="true"><i data-lucide="lock"></i></span>
            <input class="input" id="regConfirm" type="password" placeholder="Confirm password" required>
          </div>

          <label style="display:flex; gap:8px; align-items:center; font-size:14px; margin-bottom:8px;">
            <input type="checkbox" id="acceptTerms"> I accept the
            <a id="termsLinkInline" style="color:rgba(255,255,255,0.9); text-decoration:underline; cursor:pointer">terms & conditions</a>.
          </label>

          <button class="btn primary" id="doSignup">Create account</button>
          <div class="muted-center" style="margin-top:10px;">Already have an account?
            <a id="toLogin" style="color:rgba(255,255,255,0.9); text-decoration:underline; cursor:pointer">Sign in</a>
          </div>
        </form>
      </section>
    </div>
  </main>

  <!-- Terms Modal -->
  <div class="backdrop" id="termsModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="termsTitle">
      <button class="close-x" id="closeTerms">Close</button>
      <h2 id="termsTitle">Terms &amp; Conditions — MERAC</h2>
      <p class="note">Welcome to MERAC. By registering or using MERAC you agree to the following terms. Replace this sample with your final legal text when ready.</p>
      <p><strong>1. Acceptance</strong><br>By creating an account you accept these terms.</p>
      <p><strong>2. Services</strong><br>MERAC provides investment plan information; investments carry risk. MERAC is not an investment advisor.</p>
      <p><strong>3. Account</strong><br>You agree to provide accurate information and secure your credentials.</p>
      <p style="margin-top:12px; color:rgba(255,255,255,0.78);"><em>By continuing, you acknowledge that you have read and agree to these Terms & Conditions.</em></p>
      <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:12px;">
        <button class="btn primary" id="acceptTermsBtn">Accept</button>
        <button class="btn ghost" id="declineTermsBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Country Picker Modal -->
  <div class="backdrop" id="countryModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="countryTitle">
      <button class="close-x" id="closeCountry">Close</button>
      <h2 id="countryTitle">Select Country Code</h2>
      <div class="picker-head">
        <div class="search-wrap">
          <i data-lucide="search"></i>
          <input class="search" id="countrySearch" placeholder="Search country or code…">
        </div>
      </div>
      <div class="country-list" id="countryList" role="listbox" aria-label="Countries"></div>
    </div>
  </div>

  <!-- Forgot / OTP Modal -->
  <div class="backdrop" id="forgotModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="forgotTitle">
      <button class="close-x" id="closeForgot">Close</button>
      <h2 id="forgotTitle">Account Recovery</h2>
      <p class="note" id="forgotNote">Choose a verification method and enter your contact to receive a code.</p>

      <!-- method pills -->
      <div class="method-toggle" role="tablist">
        <div class="pill active" id="mEmail" role="tab" aria-selected="true"><i data-lucide="mail"></i> <span id="pillEmailTxt">Email</span></div>
        <div class="pill" id="mPhone" role="tab" aria-selected="false"><i data-lucide="phone"></i> <span id="pillPhoneTxt">Phone</span></div>
      </div>

      <!-- email input -->
      <div class="field" id="wrapEmail">
        <span class="icon"><i data-lucide="mail"></i></span>
        <input class="input" id="recoverEmail" type="email" placeholder="Email">
      </div>

      <!-- phone input with country code (same UX) -->
      <div class="field phone-wrap hidden" id="wrapPhone">
        <button type="button" class="code-pill" id="openCountry2">
          <i data-lucide="globe"></i><span id="selectedCode2">+249</span><i data-lucide="chevrons-up-down"></i>
        </button>
        <span class="icon" style="left:auto; right:12px;"><i data-lucide="phone"></i></span>
        <input class="input phone-input" id="recoverPhone" type="tel" placeholder="Phone number" inputmode="tel" autocomplete="tel">
      </div>

      <div class="resend-row">
        <button class="small-btn" id="sendCode"><i data-lucide="send"></i> <span id="sendText">Send code</span></button>
        <button class="small-btn" id="resendCode" disabled><i data-lucide="refresh-ccw"></i> <span id="resendText">Resend</span> (<span id="timer">30</span>s)</button>
      </div>

      <!-- OTP boxes -->
      <div class="otp-wrap" id="otpWrap" aria-label="Verification code">
        <input class="otp" maxlength="1" inputmode="numeric" pattern="[0-9]*">
        <input class="otp" maxlength="1" inputmode="numeric" pattern="[0-9]*">
        <input class="otp" maxlength="1" inputmode="numeric" pattern="[0-9]*">
        <input class="otp" maxlength="1" inputmode="numeric" pattern="[0-9]*">
        <input class="otp" maxlength="1" inputmode="numeric" pattern="[0-9]*">
        <input class="otp" maxlength="1" inputmode="numeric" pattern="[0-9]*">
      </div>

      <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:6px;">
        <button class="btn ghost" id="cancelVerify">Cancel</button>
        <button class="btn primary" id="doVerify">Verify</button>
      </div>
    </div>
  </div>

<script>
  // Init Lucide icons
  document.addEventListener('DOMContentLoaded', () => { if(window.lucide) lucide.replace({ 'stroke-width': 1.6, width:18, height:18 }); });

  (function(){
    const body = document.body;

    /* ---------- Tabs ---------- */
    const tabLogin = document.getElementById('tabLogin');
    const tabSignup = document.getElementById('tabSignup');
    const panelLogin = document.getElementById('panelLogin');
    const panelSignup = document.getElementById('panelSignup');

    function showLogin(){
      tabLogin.classList.add('active'); tabLogin.setAttribute('aria-selected','true');
      tabSignup.classList.remove('active'); tabSignup.setAttribute('aria-selected','false');
      panelLogin.classList.remove('hidden'); panelSignup.classList.add('hidden');
    }
    function showSignup(){
      tabSignup.classList.add('active'); tabSignup.setAttribute('aria-selected','true');
      tabLogin.classList.remove('active'); tabLogin.setAttribute('aria-selected','false');
      panelSignup.classList.remove('hidden'); panelLogin.classList.add('hidden');
    }
    tabLogin.addEventListener('click', showLogin);
    tabSignup.addEventListener('click', showSignup);
    document.getElementById('toLogin').addEventListener('click', showLogin);

    /* ---------- Language ---------- */
    const langToggle = document.getElementById('langToggle');
    let lang = 'en';
    const T = {
      en:{
        login:'Log in', signup:'Sign Up', email:'Email', password:'Password', remember:'Remember me',
        forgot:'Forgot password?', create:'Create account', fullname:'Full name', phone:'Phone number',
        acceptNotice: "By signing in you agree to MERAC's terms & conditions.",
        terms:'Terms & Conditions', selectCode:'Select Country Code', search:'Search country or code…',
        sendCode:'Send code', resend:'Resend', cancel:'Cancel', verify:'Verify',
        recoveryTitle:'Account Recovery',
        recoveryNote:'Choose a verification method and enter a contact to receive a code.',
        pillEmail:'Email', pillPhone:'Phone'
      },
      ar:{
        login:'تسجيل الدخول', signup:'إنشاء حساب', email:'البريد الإلكتروني', password:'كلمة المرور', remember:'تذكرني',
        forgot:'نسيت كلمة المرور؟', create:'إنشاء حساب', fullname:'الاسم الكامل', phone:'رقم الهاتف',
        acceptNotice:'بتسجيلك في MERAC فإنك توافق على الشروط والأحكام.',
        terms:'الشروط والأحكام', selectCode:'اختيار رمز الدولة', search:'ابحث عن دولة أو الرمز…',
        sendCode:'إرسال الرمز', resend:'إعادة الإرسال', cancel:'إلغاء', verify:'تحقق',
        recoveryTitle:'استعادة الحساب',
        recoveryNote:'اختر وسيلة التحقق وأدخل جهة الاتصال لاستلام الرمز.',
        pillEmail:'البريد الإلكتروني', pillPhone:'الهاتف'
      }
    };

    function applyLang(){
      const t = T[lang];
      // Login panel
      document.getElementById('loginEmail').placeholder = t.email;
      document.getElementById('loginPassword').placeholder = t.password;
      document.getElementById('rememberText').textContent = t.remember;
      document.getElementById('openForgot').textContent = t.forgot;
      document.getElementById('doLogin').textContent = t.login;
      document.getElementById('footerTermsInline').textContent = (lang==='ar') ? 'الشروط والأحكام' : 'terms & conditions';

      // Signup panel
      document.getElementById('regName').placeholder = t.fullname;
      document.getElementById('regEmail').placeholder = t.email;
      document.getElementById('regPhone').placeholder = t.phone;
      document.getElementById('regPassword').placeholder = t.password;
      document.getElementById('regConfirm').placeholder = (lang==='ar') ? 'تأكيد كلمة المرور' : 'Confirm password';
      document.getElementById('doSignup').textContent = t.create;
      document.getElementById('termsLinkInline').textContent = (lang==='ar') ? 'الشروط والأحكام' : 'terms & conditions';

      // Tabs labels
      tabLogin.textContent = (lang==='ar') ? 'تسجيل الدخول' : 'Login';
      tabSignup.textContent = (lang==='ar') ? 'إنشاء حساب' : 'Sign Up';

      // Top buttons
      document.getElementById('openTerms').textContent = t.terms;
      document.getElementById('countryTitle').textContent = t.selectCode;
      document.getElementById('countrySearch').placeholder = t.search;

      // Forgot modal
      document.getElementById('forgotTitle').textContent = t.recoveryTitle;
      document.getElementById('forgotNote').textContent = t.recoveryNote;
      document.getElementById('pillEmailTxt').textContent = t.pillEmail;
      document.getElementById('pillPhoneTxt').textContent = t.pillPhone;
      document.getElementById('recoverEmail').placeholder = T[lang].email;
      document.getElementById('recoverPhone').placeholder = T[lang].phone;
      document.getElementById('sendText').textContent = t.sendCode;
      document.getElementById('resendText').textContent = t.resend;
      document.getElementById('cancelVerify').textContent = t.cancel;
      document.getElementById('doVerify').textContent = t.verify;

      // Direction & lang toggle label
      body.setAttribute('dir', (lang==='ar') ? 'rtl' : 'ltr');
      langToggle.innerHTML = (lang==='ar') ? '<i data-lucide="globe"></i> EN' : '<i data-lucide="globe"></i> عربي';
      if(window.lucide) lucide.replace({ 'stroke-width': 1.6, width:18, height:18 });
    }

    langToggle.addEventListener('click', () => { lang = (lang==='en') ? 'ar' : 'en'; applyLang(); });
    applyLang();

    /* ---------- Terms modal ---------- */
    const termsModal = document.getElementById('termsModal');
    const openTerms = document.getElementById('openTerms');
    const closeTerms = document.getElementById('closeTerms');
    const acceptTermsBtn = document.getElementById('acceptTermsBtn');
    const declineTermsBtn = document.getElementById('declineTermsBtn');
    const footerTermsInline = document.getElementById('footerTermsInline');
    const termsLinkInline = document.getElementById('termsLinkInline');

    function showTerms(){ termsModal.classList.add('show'); termsModal.setAttribute('aria-hidden','false'); }
    function hideTerms(){ termsModal.classList.remove('show'); termsModal.setAttribute('aria-hidden','true'); }
    openTerms.addEventListener('click', showTerms);
    closeTerms.addEventListener('click', hideTerms);
    declineTermsBtn.addEventListener('click', hideTerms);
    acceptTermsBtn.addEventListener('click', function(){
      localStorage.setItem('merac_termsAccepted','1');
      alert((lang==='ar') ? 'شكراً — لقد قبلت الشروط.' : 'Thanks — you accepted the terms.');
      hideTerms();
    });
    if(footerTermsInline) footerTermsInline.addEventListener('click', showTerms);
    if(termsLinkInline) termsLinkInline.addEventListener('click', showTerms);
    termsModal.addEventListener('click', e=>{ if(e.target===termsModal) hideTerms(); });

    /* ---------- Password show/hide + meter ---------- */
    function togglePass(input, iconEl){
      input.type = (input.type === 'password') ? 'text' : 'password';
      if(iconEl){ iconEl.setAttribute('data-icon', (input.type==='password') ? 'eye' : 'eye-off'); }
      if(window.lucide) lucide.replace({ 'stroke-width': 1.6, width:18, height:18 });
    }
    const loginPassword = document.getElementById('loginPassword');
    document.getElementById('loginTogglePass').addEventListener('click', function(){ togglePass(loginPassword, this.querySelector('i')); });
    const regPassword = document.getElementById('regPassword');
    document.getElementById('regTogglePass').addEventListener('click', function(){ togglePass(regPassword, this.querySelector('i')); });

    function strengthScore(p){ let s=0; if(p.length>=6)s++; if(p.length>=10)s++; if(/[0-9]/.test(p))s++; if(/[A-Z]/.test(p))s++; if(/[\W_]/.test(p))s++; return Math.min(s,5); }
    function updateMeter(bar, val){
      const s = strengthScore(val), w = (s/5)*100;
      bar.style.width = w + '%';
      if(s<=1) bar.style.background='linear-gradient(90deg,#ff6b6b,#ff9b6b)';
      else if(s===2) bar.style.background='linear-gradient(90deg,#ff9b6b,#ffd86b)';
      else if(s===3) bar.style.background='linear-gradient(90deg,#ffd86b,#b7f06b)';
      else if(s===4) bar.style.background='linear-gradient(90deg,#b7f06b,#3ef0c8)';
      else bar.style.background='linear-gradient(90deg,#3ef0c8,#3ec8ff)';
    }
    loginPassword.addEventListener('input', ()=>updateMeter(document.getElementById('loginPwBar'), loginPassword.value));
    regPassword.addEventListener('input', ()=>updateMeter(document.getElementById('regPwBar'), regPassword.value));

    /* ---------- Signup (required phone) ---------- */
    const doSignup = document.getElementById('doSignup');
    doSignup.addEventListener('click', function(e){
      e.preventDefault();
      const name = document.getElementById('regName').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const phone = document.getElementById('regPhone').value.trim();
      const pass = document.getElementById('regPassword').value;
      const conf = document.getElementById('regConfirm').value;
      const accept = document.getElementById('acceptTerms').checked;
      if(!name){ return alert((lang==='ar')?'الرجاء إدخال الاسم.':'Please enter your name.'); }
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ return alert((lang==='ar')?'الرجاء إدخال بريد صحيح.':'Please enter a valid email.'); }
      if(!phone){ return alert((lang==='ar')?'رقم الهاتف إجباري.':'Phone number is required.'); }
      if(pass.length<6){ return alert((lang==='ar')?'كلمة المرور قصيرة.':'Password too short.'); }
      if(pass!==conf){ return alert((lang==='ar')?'كلمتا المرور غير متطابقتين.':'Passwords do not match.'); }
      if(!accept){ return alert((lang==='ar')?'يرجى قبول الشروط والأحكام.':'Please accept the terms & conditions.'); }

      const dial1 = document.getElementById('selectedCode').textContent;
      const users = JSON.parse(localStorage.getItem('merac_users')||'[]');
      users.push({name,email,phone: dial1 + ' ' + phone,password:pass,created:Date.now()});
      localStorage.setItem('merac_users', JSON.stringify(users));
      alert((lang==='ar') ? 'تم إنشاء الحساب (محاكاة).' : 'Account created (simulation).');
      document.getElementById('signupForm').reset();
      showLogin();
    });

    /* ---------- Login (demo) ---------- */
    document.getElementById('doLogin').addEventListener('click', function(e){
      e.preventDefault();
      const em = document.getElementById('loginEmail').value.trim();
      const pass = document.getElementById('loginPassword').value;
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(em)){ return alert((lang==='ar')?'الرجاء إدخال بريد إلكتروني صحيح.':'Please enter a valid email.'); }
      if(pass.length<6){ return alert((lang==='ar')?'كلمة المرور قصيرة.':'Password too short.'); }
      if(!localStorage.getItem('merac_termsAccepted')){ showTerms(); return alert((lang==='ar')?'يرجى قبول الشروط قبل المتابعة.':'Please accept the terms before continuing.'); }
      const users = JSON.parse(localStorage.getItem('merac_users')||'[]');
      const found = users.find(u=>u.email?.toLowerCase()===em.toLowerCase() && u.password===pass);
      if(found){ alert((lang==='ar')?'تم تسجيل الدخول بنجاح (محاكاة).':'Logged in successfully (simulation).'); location.hash='#dashboard'; }
      else { alert((lang==='ar')?'لم يتم العثور على الحساب محليًا (محاكاة).':'No local account found (simulation).'); }
    });

    /* ---------- Forgot / OTP ---------- */
    const forgotModal = document.getElementById('forgotModal');
    const openForgot = document.getElementById('openForgot');
    const closeForgot = document.getElementById('closeForgot');
    const cancelVerify = document.getElementById('cancelVerify');
    const mEmail = document.getElementById('mEmail');
    const mPhone = document.getElementById('mPhone');
    const wrapEmail = document.getElementById('wrapEmail');
    const wrapPhone = document.getElementById('wrapPhone');
    const sendBtn = document.getElementById('sendCode');
    const resendBtn = document.getElementById('resendCode');
    const timerEl = document.getElementById('timer');
    const doVerify = document.getElementById('doVerify');

    function showForgot(){ forgotModal.classList.add('show'); forgotModal.setAttribute('aria-hidden','false'); }
    function hideForgot(){ forgotModal.classList.remove('show'); forgotModal.setAttribute('aria-hidden','true'); clearOtp(); }
    openForgot.addEventListener('click', showForgot);
    closeForgot.addEventListener('click', hideForgot);
    cancelVerify.addEventListener('click', hideForgot);
    forgotModal.addEventListener('click', e=>{ if(e.target===forgotModal) hideForgot(); });

    function chooseMethod(which){
      if(which==='email'){
        mEmail.classList.add('active'); mEmail.setAttribute('aria-selected','true');
        mPhone.classList.remove('active'); mPhone.setAttribute('aria-selected','false');
        wrapEmail.classList.remove('hidden'); wrapPhone.classList.add('hidden');
      }else{
        mPhone.classList.add('active'); mPhone.setAttribute('aria-selected','true');
        mEmail.classList.remove('active'); mEmail.setAttribute('aria-selected','false');
        wrapPhone.classList.remove('hidden'); wrapEmail.classList.add('hidden');
      }
    }
    mEmail.addEventListener('click', ()=>chooseMethod('email'));
    mPhone.addEventListener('click', ()=>chooseMethod('phone'));

    let countdown=null, left=30;
    function startTimer(){
      left=30; timerEl.textContent=left; resendBtn.disabled=true;
      clearInterval(countdown);
      countdown=setInterval(()=>{
        left--; timerEl.textContent=left;
        if(left<=0){ clearInterval(countdown); resendBtn.disabled=false; timerEl.textContent='0'; }
      },1000);
    }

    sendBtn.addEventListener('click', ()=>{
      const usePhone = mPhone.classList.contains('active');
      if(usePhone){
        const phoneVal = document.getElementById('recoverPhone').value.trim();
        if(!phoneVal) return alert((lang==='ar')?'أدخل رقم الهاتف.':'Enter phone number.');
      }else{
        const emailVal = document.getElementById('recoverEmail').value.trim();
        if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailVal)) return alert((lang==='ar')?'أدخل بريداً صالحاً.':'Enter a valid email.');
      }
      // simulate sending
      alert((lang==='ar')?'تم إرسال الرمز.':'Code sent.');
      startTimer();
      focusFirstOtp();
    });

    resendBtn.addEventListener('click', ()=>{
      alert((lang==='ar')?'تمت إعادة إرسال الرمز.':'Code resent.');
      startTimer();
      clearOtp(); focusFirstOtp();
    });

    function focusFirstOtp(){ const first = document.querySelector('.otp-wrap .otp'); if(first){ first.focus(); first.select(); } }
    function clearOtp(){ document.querySelectorAll('.otp').forEach(i=>i.value=''); }

    // OTP behavior: auto-advance / backspace / paste
    const otpInputs = Array.from(document.querySelectorAll('.otp'));
    otpInputs.forEach((inp, idx)=>{
      inp.addEventListener('input', e=>{
        const v = e.target.value.replace(/\D/g,'').slice(0,1);
        e.target.value = v;
        if(v && idx<otpInputs.length-1) otpInputs[idx+1].focus();
      });
      inp.addEventListener('keydown', e=>{
        if(e.key==='Backspace' && !inp.value && idx>0) otpInputs[idx-1].focus();
        if(e.key==='ArrowLeft' && idx>0) otpInputs[idx-1].focus();
        if(e.key==='ArrowRight' && idx<otpInputs.length-1) otpInputs[idx+1].focus();
      });
      inp.addEventListener('paste', e=>{
        const data = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g,'').slice(0,6);
        if(data){ e.preventDefault(); otpInputs.forEach((el,i)=> el.value = data[i]||''); otpInputs[Math.min(data.length,5)].focus(); }
      });
    });

    doVerify.addEventListener('click', ()=>{
      const code = otpInputs.map(i=>i.value).join('');
      if(code.length!==6) return alert((lang==='ar')?'أدخل الرمز من 6 خانات.':'Enter the 6-digit code.');
      alert((lang==='ar')?'تم التحقق بنجاح (محاكاة).':'Verified successfully (simulation).');
      hideForgot();
    });

    /* ---------- Country Picker ---------- */
    // shared selected codes
    let selectedDial = '+249';
    let selectedDial2 = '+249';
    const openCountry = document.getElementById('openCountry');
    const openCountry2 = document.getElementById('openCountry2');
    const countryModal = document.getElementById('countryModal');
    const closeCountry = document.getElementById('closeCountry');
    const countryList = document.getElementById('countryList');
    const countrySearch = document.getElementById('countrySearch');
    const selectedCodeEl = document.getElementById('selectedCode');
    const selectedCodeEl2 = document.getElementById('selectedCode2');

    function showCountry(){ countryModal.classList.add('show'); countryModal.setAttribute('aria-hidden','false'); countrySearch.focus(); }
    function hideCountry(){ countryModal.classList.remove('show'); countryModal.setAttribute('aria-hidden','true'); }
    let targetPicker = 1; // 1=signup, 2=forgot
    openCountry.addEventListener('click', ()=>{ targetPicker=1; showCountry(); });
    openCountry2.addEventListener('click', ()=>{ targetPicker=2; showCountry(); });
    closeCountry.addEventListener('click', hideCountry);
    countryModal.addEventListener('click', e=>{ if(e.target===countryModal) hideCountry(); });

    const COUNTRIES = [
      {n:'Afghanistan', c:'+93'}, {n:'Albania', c:'+355'}, {n:'Algeria', c:'+213'},
      {n:'American Samoa', c:'+1684'}, {n:'Andorra', c:'+376'}, {n:'Angola', c:'+244'},
      {n:'Anguilla', c:'+1264'}, {n:'Antigua and Barbuda', c:'+1268'}, {n:'Argentina', c:'+54'},
      {n:'Armenia', c:'+374'}, {n:'Aruba', c:'+297'}, {n:'Australia', c:'+61'},
      {n:'Austria', c:'+43'}, {n:'Azerbaijan', c:'+994'}, {n:'Bahamas', c:'+1242'},
      {n:'Bahrain', c:'+973'}, {n:'Bangladesh', c:'+880'}, {n:'Barbados', c:'+1246'},
      {n:'Belarus', c:'+375'}, {n:'Belgium', c:'+32'}, {n:'Belize', c:'+501'},
      {n:'Benin', c:'+229'}, {n:'Bermuda', c:'+1441'}, {n:'Bhutan', c:'+975'},
      {n:'Bolivia', c:'+591'}, {n:'Bosnia and Herzegovina', c:'+387'}, {n:'Botswana', c:'+267'},
      {n:'Brazil', c:'+55'}, {n:'British Indian Ocean Territory', c:'+246'}, {n:'British Virgin Islands', c:'+1284'},
      {n:'Brunei', c:'+673'}, {n:'Bulgaria', c:'+359'}, {n:'Burkina Faso', c:'+226'},
      {n:'Burundi', c:'+257'}, {n:'Cambodia', c:'+855'}, {n:'Cameroon', c:'+237'},
      {n:'Canada', c:'+1'}, {n:'Cape Verde', c:'+238'}, {n:'Cayman Islands', c:'+1345'},
      {n:'Central African Republic', c:'+236'}, {n:'Chad', c:'+235'}, {n:'Chile', c:'+56'},
      {n:'China', c:'+86'}, {n:'Christmas Island', c:'+61'}, {n:'Cocos (Keeling) Islands', c:'+61'},
      {n:'Colombia', c:'+57'}, {n:'Comoros', c:'+269'}, {n:'Congo (Brazzaville)', c:'+242'},
      {n:'Congo (Kinshasa)', c:'+243'}, {n:'Cook Islands', c:'+682'}, {n:'Costa Rica', c:'+506'},
      {n:'Côte d’Ivoire', c:'+225'}, {n:'Croatia', c:'+385'}, {n:'Cuba', c:'+53'},
      {n:'Curaçao', c:'+599'}, {n:'Cyprus', c:'+357'}, {n:'Czechia', c:'+420'},
      {n:'Denmark', c:'+45'}, {n:'Djibouti', c:'+253'}, {n:'Dominica', c:'+1767'},
      {n:'Dominican Republic', c:'+1'}, {n:'Ecuador', c:'+593'}, {n:'Egypt', c:'+20'},
      {n:'El Salvador', c:'+503'}, {n:'Equatorial Guinea', c:'+240'}, {n:'Eritrea', c:'+291'},
      {n:'Estonia', c:'+372'}, {n:'Eswatini', c:'+268'}, {n:'Ethiopia', c:'+251'},
      {n:'Falkland Islands', c:'+500'}, {n:'Faroe Islands', c:'+298'}, {n:'Fiji', c:'+679'},
      {n:'Finland', c:'+358'}, {n:'France', c:'+33'}, {n:'French Guiana', c:'+594'},
      {n:'French Polynesia', c:'+689'}, {n:'Gabon', c:'+241'}, {n:'Gambia', c:'+220'},
      {n:'Georgia', c:'+995'}, {n:'Germany', c:'+49'}, {n:'Ghana', c:'+233'},
      {n:'Gibraltar', c:'+350'}, {n:'Greece', c:'+30'}, {n:'Greenland', c:'+299'},
      {n:'Grenada', c:'+1473'}, {n:'Guadeloupe', c:'+590'}, {n:'Guam', c:'+1671'},
      {n:'Guatemala', c:'+502'}, {n:'Guernsey', c:'+44'}, {n:'Guinea', c:'+224'},
      {n:'Guinea-Bissau', c:'+245'}, {n:'Guyana', c:'+592'}, {n:'Haiti', c:'+509'},
      {n:'Honduras', c:'+504'}, {n:'Hong Kong', c:'+852'}, {n:'Hungary', c:'+36'},
      {n:'Iceland', c:'+354'}, {n:'India', c:'+91'}, {n:'Indonesia', c:'+62'},
      {n:'Iran', c:'+98'}, {n:'Iraq', c:'+964'}, {n:'Ireland', c:'+353'},
      {n:'Isle of Man', c:'+44'}, {n:'Israel', c:'+972'}, {n:'Italy', c:'+39'},
      {n:'Jamaica', c:'+1876'}, {n:'Japan', c:'+81'}, {n:'Jersey', c:'+44'},
      {n:'Jordan', c:'+962'}, {n:'Kazakhstan', c:'+7'}, {n:'Kenya', c:'+254'},
      {n:'Kiribati', c:'+686'}, {n:'Kuwait', c:'+965'}, {n:'Kyrgyzstan', c:'+996'},
      {n:'Laos', c:'+856'}, {n:'Latvia', c:'+371'}, {n:'Lebanon', c:'+961'},
      {n:'Lesotho', c:'+266'}, {n:'Liberia', c:'+231'}, {n:'Libya', c:'+218'},
      {n:'Liechtenstein', c:'+423'}, {n:'Lithuania', c:'+370'}, {n:'Luxembourg', c:'+352'},
      {n:'Macao', c:'+853'}, {n:'North Macedonia', c:'+389'}, {n:'Madagascar', c:'+261'},
      {n:'Malawi', c:'+265'}, {n:'Malaysia', c:'+60'}, {n:'Maldives', c:'+960'},
      {n:'Mali', c:'+223'}, {n:'Malta', c:'+356'}, {n:'Marshall Islands', c:'+692'},
      {n:'Martinique', c:'+596'}, {n:'Mauritania', c:'+222'}, {n:'Mauritius', c:'+230'},
      {n:'Mayotte', c:'+262'}, {n:'Mexico', c:'+52'}, {n:'Micronesia', c:'+691'},
      {n:'Moldova', c:'+373'}, {n:'Monaco', c:'+377'}, {n:'Mongolia', c:'+976'},
      {n:'Montenegro', c:'+382'}, {n:'Montserrat', c:'+1664'}, {n:'Morocco', c:'+212'},
      {n:'Mozambique', c:'+258'}, {n:'Myanmar', c:'+95'}, {n:'Namibia', c:'+264'},
      {n:'Nauru', c:'+674'}, {n:'Nepal', c:'+977'}, {n:'Netherlands', c:'+31'},
      {n:'New Caledonia', c:'+687'}, {n:'New Zealand', c:'+64'}, {n:'Nicaragua', c:'+505'},
      {n:'Niger', c:'+227'}, {n:'Nigeria', c:'+234'}, {n:'Niue', c:'+683'},
      {n:'Norfolk Island', c:'+672'}, {n:'North Korea', c:'+850'}, {n:'Norway', c:'+47'},
      {n:'Oman', c:'+968'}, {n:'Pakistan', c:'+92'}, {n:'Palau', c:'+680'},
      {n:'Palestine', c:'+970'}, {n:'Panama', c:'+507'}, {n:'Papua New Guinea', c:'+675'},
      {n:'Paraguay', c:'+595'}, {n:'Peru', c:'+51'}, {n:'Philippines', c:'+63'},
      {n:'Poland', c:'+48'}, {n:'Portugal', c:'+351'}, {n:'Puerto Rico', c:'+1'},
      {n:'Qatar', c:'+974'}, {n:'Réunion', c:'+262'}, {n:'Romania', c:'+40'},
      {n:'Russia', c:'+7'}, {n:'Rwanda', c:'+250'}, {n:'Saint Barthélemy', c:'+590'},
      {n:'Saint Helena', c:'+290'}, {n:'Saint Kitts and Nevis', c:'+1869'}, {n:'Saint Lucia', c:'+1758'},
      {n:'Saint Martin', c:'+590'}, {n:'Saint Pierre and Miquelon', c:'+508'}, {n:'Saint Vincent and the Grenadines', c:'+1784'},
      {n:'Samoa', c:'+685'}, {n:'San Marino', c:'+378'}, {n:'São Tomé and Príncipe', c:'+239'},
      {n:'Saudi Arabia', c:'+966'}, {n:'Senegal', c:'+221'}, {n:'Serbia', c:'+381'},
      {n:'Seychelles', c:'+248'}, {n:'Sierra Leone', c:'+232'}, {n:'Singapore', c:'+65'},
      {n:'Slovakia', c:'+421'}, {n:'Slovenia', c:'+386'}, {n:'Solomon Islands', c:'+677'},
      {n:'Somalia', c:'+252'}, {n:'South Africa', c:'+27'}, {n:'South Korea', c:'+82'},
      {n:'South Sudan', c:'+211'}, {n:'Spain', c:'+34'}, {n:'Sri Lanka', c:'+94'},
      {n:'Sudan', c:'+249'}, {n:'Suriname', c:'+597'}, {n:'Svalbard and Jan Mayen', c:'+47'},
      {n:'Sweden', c:'+46'}, {n:'Switzerland', c:'+41'}, {n:'Syria', c:'+963'},
      {n:'Taiwan', c:'+886'}, {n:'Tajikistan', c:'+992'}, {n:'Tanzania', c:'+255'},
      {n:'Thailand', c:'+66'}, {n:'Togo', c:'+228'}, {n:'Tokelau', c:'+690'},
      {n:'Tonga', c:'+676'}, {n:'Trinidad and Tobago', c:'+1868'}, {n:'Tunisia', c:'+216'},
      {n:'Türkiye', c:'+90'}, {n:'Turkmenistan', c:'+993'}, {n:'Turks and Caicos Islands', c:'+1649'},
      {n:'Tuvalu', c:'+688'}, {n:'Uganda', c:'+256'}, {n:'Ukraine', c:'+380'},
      {n:'United Arab Emirates', c:'+971'}, {n:'United Kingdom', c:'+44'}, {n:'United States', c:'+1'},
      {n:'Uruguay', c:'+598'}, {n:'Uzbekistan', c:'+998'}, {n:'Vanuatu', c:'+678'},
      {n:'Vatican City', c:'+39'}, {n:'Venezuela', c:'+58'}, {n:'Vietnam', c:'+84'},
      {n:'Wallis and Futuna', c:'+681'}, {n:'Western Sahara', c:'+212'}, {n:'Yemen', c:'+967'},
      {n:'Zambia', c:'+260'}, {n:'Zimbabwe', c:'+263'}
    ];

    function renderCountries(list){
      countryList.innerHTML = '';
      list.forEach(item=>{
        const row = document.createElement('div');
        row.className = 'country-item';
        row.setAttribute('role','option');
        row.innerHTML = `
          <div style="display:flex; align-items:center; gap:10px;">
            <i data-lucide="map-pin"></i>
            <div class="country-name">${item.n}</div>
          </div>
          <div class="country-code">${item.c}</div>`;
        row.addEventListener('click', ()=>{
          if(targetPicker===1){ selectedDial = item.c; selectedCodeEl.textContent = item.c; }
          else { selectedDial2 = item.c; selectedCodeEl2.textContent = item.c; }
          hideCountry();
        });
        countryList.appendChild(row);
      });
      if(window.lucide) lucide.replace({ 'stroke-width': 1.6, width:18, height:18 });
    }
    renderCountries(COUNTRIES);

    countrySearch.addEventListener('input', ()=>{
      const q = countrySearch.value.trim().toLowerCase();
      const filtered = COUNTRIES.filter(x => x.n.toLowerCase().includes(q) || x.c.includes(q));
      renderCountries(filtered);
    });

    /* ---------- Country pill selected defaults ---------- */
    selectedCodeEl.textContent = selectedDial;
    selectedCodeEl2.textContent = selectedDial2;

    /* ---------- Second picker open buttons ---------- */
    function showCountry(){ countryModal.classList.add('show'); countryModal.setAttribute('aria-hidden','false'); countrySearch.focus(); }
    function hideCountry(){ countryModal.classList.remove('show'); countryModal.setAttribute('aria-hidden','true'); }

    /* ---------- Misc ---------- */
    // Remember me prefill
    const remembered = localStorage.getItem('merac_remember');
    if(remembered){ document.getElementById('loginEmail').value = remembered; document.getElementById('rememberLogin').checked = true; }
    document.getElementById('rememberLogin').addEventListener('change', (e)=>{
      if(e.target.checked){ localStorage.setItem('merac_remember', document.getElementById('loginEmail').value.trim()); }
      else { localStorage.removeItem('merac_remember'); }
    });

    // Close modals with Escape
    document.addEventListener('keydown', e=>{
      if(e.key==='Escape'){
        document.querySelectorAll('.backdrop').forEach(b=>b.classList.remove('show'));
      }
    });

    // Ensure Lucide refresh after dynamic content changes
    const obs = new MutationObserver(()=>{ if(window.lucide) lucide.replace({ 'stroke-width': 1.6, width:18, height:18 }); });
    obs.observe(document.body, { childList:true, subtree:true });

  })();
</script>
</body>
</html>