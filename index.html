<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MERAC — Login / Sign Up</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest/dist/lucide.min.js"></script>
<style>
:root{
  --bg1:#060616; --bg2:#0b1330;
  --accent-from:#3EC8FF; --accent-to:#7A4BFF;
  --glass-1: rgba(255,255,255,0.03);
  --glass-2: rgba(255,255,255,0.015);
  --input-border: rgba(255,255,255,0.06);
  --muted: rgba(255,255,255,0.62);
  --shadow: 0 18px 60px rgba(2,6,23,0.65);
  --card-w: 520px;
  --otp-size: 48px;
}
@media (max-width:520px){
  :root{ --card-w: 94vw; --otp-size: 44px; }
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:'Poppins',system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  background:
    radial-gradient(1000px 500px at 14% 62%, rgba(62,200,255,0.06), transparent 8%),
    radial-gradient(800px 500px at 88% 52%, rgba(122,75,255,0.08), transparent 10%),
    linear-gradient(180deg,var(--bg2),var(--bg1));
  color:#fff;
  display:flex; align-items:center; justify-content:center;
  padding:36px;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
.top-controls{
  position:fixed; top:22px; left:22px; right:22px;
  display:flex; justify-content:space-between; align-items:center;
  pointer-events:none; z-index:60;
}
.top-controls button{
  pointer-events:auto; cursor:pointer;
  border-radius:12px; padding:10px 14px; font-size:14px;
  backdrop-filter: blur(6px);
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.02);
  color: var(--muted);
}
.lang-btn{ display:inline-flex; gap:8px; align-items:center; color:#fff; border:1px solid rgba(255,255,255,0.03); background: rgba(255,255,255,0.03); }
.card{
  width:var(--card-w); max-width:94vw;
  border-radius:20px; padding:28px;
  background: linear-gradient(180deg,var(--glass-1),var(--glass-2));
  border:1px solid rgba(58,86,255,0.04);
  box-shadow: var(--shadow); backdrop-filter: blur(10px) saturate(120%);
  position:relative; overflow:hidden;
}
.logo{ display:flex; gap:14px; align-items:center; justify-content:center; margin-bottom:18px; }
.logo img{ width:72px; height:72px; object-fit:contain; }
.logo h1{ margin:0; font-size:36px; font-weight:800; letter-spacing:1px; }
.tabs{ display:flex; gap:8px; justify-content:center; margin-bottom:18px; }
.tab-btn{
  flex:1; text-align:center; padding:10px 12px; border-radius:12px; cursor:pointer;
  font-weight:600; background:transparent; border:1px solid transparent;
  color: rgba(255,255,255,0.86); transition: all .18s ease; user-select:none;
}
.tab-btn.active{
  background: linear-gradient(90deg,var(--accent-from),var(--accent-to));
  color:#fff; box-shadow: 0 8px 28px rgba(122,75,255,0.12); transform: translateY(-2px);
}
.forms{ position:relative; height:auto; }
.form-panel{ transition: transform .28s cubic-bezier(.2,.9,.3,1), opacity .2s ease; }
.form-panel.hidden{ opacity:0; pointer-events:none; transform: translateY(10px); height:0; overflow:hidden; }
.field{ position:relative; margin-bottom:14px; }
.field .icon{ position:absolute; left:12px; top:50%; transform:translateY(-50%); opacity:0.95; pointer-events:none; }
body[dir="rtl"] .field .icon{ left:auto; right:12px; }
.input{
  width:100%; height:52px; padding:12px 14px 12px 44px;
  border-radius:12px; border:1px solid var(--input-border);
  background: rgba(255,255,255,0.01); color:#fff; outline:none; font-size:15px;
  transition: box-shadow .14s ease, border .14s ease;
}
body[dir="rtl"] .input{ padding:12px 44px 12px 14px; }
.input::placeholder{ color: rgba(255,255,255,0.36); }
.input:focus{ border:1px solid rgba(255,255,255,0.12); box-shadow: 0 8px 22px rgba(2,6,23,0.5); background: rgba(255,255,255,0.015); }
.show-pass{
  position:absolute; right:10px; top:50%; transform: translateY(-50%);
  background:transparent; border:none; cursor:pointer; font-size:16px; color:rgba(255,255,255,0.7);
}
body[dir="rtl"] .show-pass{ right:auto; left:10px; }
.phone-wrap{ position:relative; }
.code-pill{
  position:absolute; top:6px; left:6px; height:40px; display:inline-flex; align-items:center; gap:6px;
  padding:0 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.06);
  background: rgba(255,255,255,0.03); color:#fff; cursor:pointer; z-index:2;
}
.code-pill i{ opacity:.9 }
.phone-input{ padding-left:92px !important; }
body[dir="rtl"] .code-pill{ left:auto; right:6px; }
body[dir="rtl"] .phone-input{ padding-right:92px !important; padding-left:14px !important; }
.row{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
.remember{ display:flex; gap:8px; align-items:center; color:var(--muted); font-size:14px; }
.forgot-link{ color:rgba(255,255,255,0.86); cursor:pointer; text-decoration:none; font-size:14px; }
.btn{ width:100%; height:54px; border-radius:14px; border:none; font-weight:700; font-size:16px; cursor:pointer; }
.btn.primary{ background: linear-gradient(90deg,var(--accent-from),var(--accent-to)); color:#fff; box-shadow: 0 12px 36px rgba(122,75,255,0.14); }
.btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:rgba(255,255,255,0.9); }
.muted-center{ text-align:center; color:var(--muted); font-size:13px; margin-top:10px; }
.pw-meter{ height:8px; background: rgba(255,255,255,0.05); border-radius:8px; overflow:hidden; margin-top:8px; }
.pw-meter > i{ display:block; height:100%; width:0%; transition: width .2s ease; background: linear-gradient(90deg,#ff6b6b,#ffd86b); }
.backdrop{
  position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
  background: rgba(4,8,18,0.55); z-index:120; visibility:hidden; opacity:0; transition:opacity .14s ease, visibility .14s;
}
.backdrop.show{ visibility:visible; opacity:1; }
.modal{
  width:720px; max-width:94vw; max-height:86vh; overflow:auto;
  border-radius:16px; padding:22px;
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015));
  border:1px solid rgba(255,255,255,0.04);
  backdrop-filter: blur(12px) saturate(120%); box-shadow: 0 24px 80px rgba(3,6,20,0.6);
  color: rgba(255,255,255,0.98); position:relative;
}
.modal .close-x{ position:absolute; top:12px; right:14px; padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background: rgba(255,255,255,0.02); cursor:pointer; color:#ff[...]
.note{ font-size:13px; color: rgba(255,255,255,0.75); }
.picker-head{ display:flex; align-items:center; gap:10px; margin-bottom:12px; }
.search{
  flex:1; height:44px; border-radius:12px; border:1px solid var(--input-border);
  background: rgba(255,255,255,0.02); color:#fff; outline:none; padding:10px 12px 10px 40px;
}
.search-wrap{ position:relative; flex:1; }
.search-wrap i{ position:absolute; left:10px; top:50%; transform:translateY(-50%); opacity:.9 }
body[dir="rtl"] .search-wrap i{ left:auto; right:10px; }
body[dir="rtl"] .search{ padding:10px 40px 10px 12px; }
.country-list{ margin-top:8px; border-top:1px solid rgba(255,255,255,0.05); }
.country-item{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:10px 4px; border-bottom:1px solid rgba(255,255,255,0.04); cursor:pointer;
}
.country-item:hover{ background: rgba(255,255,255,0.02); }
.country-name{ font-size:14px; }
.country-code{ opacity:.9; font-weight:700; }
.method-toggle{ display:flex; gap:8px; margin:8px 0 12px; }
.pill{
  flex:1; text-align:center; padding:10px 12px; border-radius:12px;
  border:1px solid rgba(255,255,255,0.06); background: rgba(255,255,255,0.02);
  color:#fff; cursor:pointer; user-select:none;
}
.pill.active{ background: linear-gradient(90deg,var(--accent-from),var(--accent-to)); border-color: transparent; }
.otp-wrap{ display:grid; grid-template-columns: repeat(6, var(--otp-size)); gap:10px; justify-content:center; margin:12px 0; }
.otp{ width:var(--otp-size); height:var(--otp-size); border-radius:12px; border:1px solid var(--input-border);
      background: rgba(255,255,255,0.02); color:#fff; font-size:22px; text-align:center; outline:none; }
.resend-row{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:8px; }
.small-btn{ padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:#fff; cursor:pointer; }
.small-btn[disabled]{ opacity:.5; cursor:not-allowed; }
@media (max-width:520px){
  .logo h1{ font-size:28px; }
  .card{ padding:18px; border-radius:14px; }
  .tab-btn{ padding:8px 10px; }
}
</style>
</head>
<body dir="ltr">
  <div class="top-controls" aria-hidden="false">
    <button id="openTerms">Terms &amp; Conditions</button>
    <button class="lang-btn" id="langToggle"><i data-lucide="globe"></i> عربي</button>
  </div>
  <main class="card" role="main" aria-labelledby="meracTitle">
    <div class="logo">
      <img src="https://i.postimg.cc/WzX8R9rC/mirac-removebg-preview.png" alt="MERAC logo">
      <h1 id="meracTitle">MERAC</h1>
    </div>
    <div class="tabs" role="tablist" aria-label="Auth tabs">
      <div class="tab-btn active" id="tabLogin" role="tab" tabindex="0" aria-selected="true">Login</div>
      <div class="tab-btn" id="tabSignup" role="tab" tabindex="0" aria-selected="false">Sign Up</div>
    </div>
    <div class="forms">
      <section class="form-panel" id="panelLogin" aria-labelledby="tabLogin">
        <form id="loginForm" onsubmit="return false;" autocomplete="on" novalidate>
          <div class="field">
            <span class="icon" aria-hidden="true"><i data-lucide="mail"></i></span>
            <input class="input" id="loginEmail" type="email" placeholder="Email" required autocomplete="username">
          </div>
          <div class="field">
            <span class="icon" aria-hidden="true"><i data-lucide="lock"></i></span>
            <input class="input" id="loginPassword" type="password" placeholder="Password" required autocomplete="current-password" minlength="6">
            <button type="button" class="show-pass" id="loginTogglePass" aria-label="Show password"><i data-lucide="eye"></i></button>
            <div class="pw-meter" aria-hidden="true"><i id="loginPwBar"></i></div>
          </div>
          <div class="row">
            <label class="remember"><input type="checkbox" id="rememberLogin"> <span id="rememberText">Remember me</span></label>
            <a class="forgot-link" id="openForgot">Forgot password?</a>
          </div>
          <button class="btn primary" id="doLogin">Log in</button>
          <div class="muted-center" style="margin-top:12px;">
            By signing in you agree to MERAC's
            <a id="footerTermsInline" style="color:rgba(255,255,255,0.9); text-decoration:underline; cursor:pointer">terms & conditions</a>.
          </div>
          <button type="button" class="btn ghost" id="reloadDataBtn" style="margin-top:12px;">Reload users from data.json</button>
        </form>
      </section>
      <section class="form-panel hidden" id="panelSignup" aria-labelledby="tabSignup">
        <form id="signupForm" onsubmit="return false;" novalidate>
          <div class="field">
            <span class="icon" aria-hidden="true"><i data-lucide="user"></i></span>
            <input class="input" id="regName" type="text" placeholder="Full name" required>
          </div>
          <div class="field">
            <span class="icon" aria-hidden="true"><i data-lucide="mail"></i></span>
            <input class="input" id="regEmail" type="email" placeholder="Email" required>
          </div>
          <div class="field phone-wrap">
            <button type="button" class="code-pill" id="openCountry">
              <i data-lucide="globe"></i><span id="selectedCode">+249</span><i data-lucide="chevrons-up-down"></i>
            </button>
            <span class="icon" aria-hidden="true" style="left:auto; right:12px;"><i data-lucide="phone"></i></span>
            <input class="input phone-input" id="regPhone" type="tel" placeholder="Phone number" required inputmode="tel" autocomplete="tel">
          </div>
          <div class="field">
            <span class="icon" aria-hidden="true"><i data-lucide="lock"></i></span>
            <input class="input" id="regPassword" type="password" placeholder="Password" required minlength="6">
            <button type="button" class="show-pass" id="regTogglePass" aria-label="Show password"><i data-lucide="eye"></i></button>
            <div class="pw-meter" aria-hidden="true"><i id="regPwBar"></i></div>
          </div>
          <div class="field">
            <span class="icon" aria-hidden="true"><i data-lucide="lock"></i></span>
            <input class="input" id="regConfirm" type="password" placeholder="Confirm password" required>
          </div>
          <label style="display:flex; gap:8px; align-items:center; font-size:14px; margin-bottom:8px;">
            <input type="checkbox" id="acceptTerms"> I accept the
            <a id="termsLinkInline" style="color:rgba(255,255,255,0.9); text-decoration:underline; cursor:pointer">terms & conditions</a>.
          </label>
          <button class="btn primary" id="doSignup">Create account</button>
          <div class="muted-center" style="margin-top:10px;">Already have an account?
            <a id="toLogin" style="color:rgba(255,255,255,0.9); text-decoration:underline; cursor:pointer">Sign in</a>
          </div>
        </form>
      </section>
    </div>
  </main>
  <!-- باقي المودالات ... -->
<script>
document.addEventListener('DOMContentLoaded', () => { if(window.lucide) lucide.replace({ 'stroke-width': 1.6, width:18, height:18 }); });
(function(){
  // ========== Tabs ==========
  const tabLogin = document.getElementById('tabLogin');
  const tabSignup = document.getElementById('tabSignup');
  const panelLogin = document.getElementById('panelLogin');
  const panelSignup = document.getElementById('panelSignup');
  function showLogin(){ tabLogin.classList.add('active'); tabLogin.setAttribute('aria-selected','true'); tabSignup.classList.remove('active'); tabSignup.setAttribute('aria-selected','false'); panelLogin.classList.remove('hidden'); panelSignup.classList.add('hidden'); }
  function showSignup(){ tabSignup.classList.add('active'); tabSignup.setAttribute('aria-selected','true'); tabLogin.classList.remove('active'); tabLogin.setAttribute('aria-selected','false'); panelSignup.classList.remove('hidden'); panelLogin.classList.add('hidden'); }
  tabLogin.addEventListener('click', showLogin);
  tabSignup.addEventListener('click', showSignup);
  document.getElementById('toLogin').addEventListener('click', showLogin);

  // ========== Lang (اختياري) ==========
  const langToggle = document.getElementById('langToggle');
  let lang = 'en';
  langToggle.addEventListener('click', () => { lang = (lang==='en') ? 'ar' : 'en'; });

  // ========== قراءة وكتابة المستخدمين من/إلى data.json ==========
  async function readUsersFromFile() {
    try {
      const res = await fetch('data.json?cache=' + Date.now());
      if (!res.ok) return [];
      const users = await res.json();
      if (Array.isArray(users)) return users;
      return [];
    } catch {
      return [];
    }
  }
  function saveUsersToLocal(usersArr) {
    localStorage.setItem('merac_datajson', JSON.stringify(usersArr));
  }
  function getUsersFromLocal() {
    let arr = [];
    try { arr = JSON.parse(localStorage.getItem('merac_datajson') || "[]"); } catch {}
    if (!Array.isArray(arr)) arr = [];
    return arr;
  }
  if (!localStorage.getItem('merac_datajson')) {
    readUsersFromFile().then(users => {
      saveUsersToLocal(users);
    });
  }
  document.getElementById('reloadDataBtn').addEventListener('click', function() {
    readUsersFromFile().then(users => {
      saveUsersToLocal(users);
      alert((lang==='ar') ? 'تم تحديث المستخدمين من ملف data.json' : 'Users updated from data.json');
    });
  });

  // ========== SIGNUP ==========
  function generateUserId() {
    return 'user_' + Date.now() + '_' + Math.floor(Math.random()*1e6);
  }
  document.getElementById('doSignup').addEventListener('click', function(e){
    e.preventDefault();
    const name = document.getElementById('regName').value.trim();
    const email = document.getElementById('regEmail').value.trim();
    const phone = document.getElementById('regPhone').value.trim();
    const pass = document.getElementById('regPassword').value;
    const conf = document.getElementById('regConfirm').value;
    const accept = document.getElementById('acceptTerms').checked;
    if(!name){ return alert((lang==='ar')?'الرجاء إدخال الاسم.':'Please enter your name.'); }
    if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ return alert((lang==='ar')?'الرجاء إدخال بريد صحيح.':'Please enter a valid email.'); }
    if(!phone){ return alert((lang==='ar')?'رقم الهاتف إجباري.':'Phone number is required.'); }
    if(pass.length<6){ return alert((lang==='ar')?'كلمة المرور قصيرة.':'Password too short.'); }
    if(pass!==conf){ return alert((lang==='ar')?'كلمتا المرور غير متطابقتين.':'Passwords do not match.'); }
    if(!accept){ return alert((lang==='ar')?'يرجى قبول الشروط والأحكام.':'Please accept the terms & conditions.'); }
    let usersArr = getUsersFromLocal();
    // Unique ID for every user
    let userId = generateUserId();
    // Ensure email not already used
    if(usersArr.some(u => u.email && u.email.toLowerCase() === email.toLowerCase())) {
      return alert((lang==='ar') ? 'البريد الإلكتروني مستخدم من قبل.' : 'Email already used.');
    }
    const userObj = {
      id: userId,
      name: name,
      email: email,
      password: pass // تم الحفظ كنص عادي (تجريبي فقط)
    };
    usersArr.push(userObj);
    saveUsersToLocal(usersArr);
    alert((lang==='ar') ? 'تم إنشاء الحساب. بياناتك محفوظة محلياً.' : 'Account created. Your data is saved locally.');
    document.getElementById('signupForm').reset();
    showLogin();
  });

  // ========== LOGIN ==========
  document.getElementById('doLogin').addEventListener('click', function(e){
    e.preventDefault();
    const em = document.getElementById('loginEmail').value.trim();
    const pass = document.getElementById('loginPassword').value;
    if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(em)){ return alert((lang==='ar')?'الرجاء إدخال بريد إلكتروني صحيح.':'Please enter a valid email.'); }
    if(pass.length<6){ return alert((lang==='ar')?'كلمة المرور قصيرة.':'Password too short.'); }
    let usersArr = getUsersFromLocal();
    const found = usersArr.find(u=>u.email?.toLowerCase()===em.toLowerCase() && u.password===pass);
    if(found){
      alert((lang==='ar') ? 'تم تسجيل الدخول بنجاح.' : 'Login successful.');
      window.location.href = "home.html";
    }
    else {
      alert((lang==='ar')?'لم يتم العثور على الحساب في ملف data.json.':'Account not found in data.json.');
    }
  });

  // ========== Show/Hide Password ==========
  function togglePass(input, iconEl){
    input.type = (input.type === 'password') ? 'text' : 'password';
    if(iconEl){ iconEl.setAttribute('data-icon', (input.type==='password') ? 'eye' : 'eye-off'); }
    if(window.lucide) lucide.replace({ 'stroke-width': 1.6, width:18, height:18 });
  }
  const loginPassword = document.getElementById('loginPassword');
  document.getElementById('loginTogglePass').addEventListener('click', function(){ togglePass(loginPassword, this.querySelector('i')); });
  const regPassword = document.getElementById('regPassword');
  document.getElementById('regTogglePass').addEventListener('click', function(){ togglePass(regPassword, this.querySelector('i')); });

  // ========== قوة كلمة المرور ==========
  function strengthScore(p){ let s=0; if(p.length>=6)s++; if(p.length>=10)s++; if(/[0-9]/.test(p))s++; if(/[A-Z]/.test(p))s++; if(/[\W_]/.test(p))s++; return Math.min(s,5); }
  function updateMeter(bar, val){
    const s = strengthScore(val), w = (s/5)*100;
    bar.style.width = w + '%';
    if(s<=1) bar.style.background='linear-gradient(90deg,#ff6b6b,#ff9b6b)';
    else if(s===2) bar.style.background='linear-gradient(90deg,#ff9b6b,#ffd86b)';
    else if(s===3) bar.style.background='linear-gradient(90deg,#ffd86b,#b7f06b)';
    else if(s===4) bar.style.background='linear-gradient(90deg,#b7f06b,#3ef0c8)';
    else bar.style.background='linear-gradient(90deg,#3ef0c8,#3ec8ff)';
  }
  loginPassword.addEventListener('input', ()=>updateMeter(document.getElementById('loginPwBar'), loginPassword.value));
  regPassword.addEventListener('input', ()=>updateMeter(document.getElementById('regPwBar'), regPassword.value));
})();
</script>
</body>
</html>
